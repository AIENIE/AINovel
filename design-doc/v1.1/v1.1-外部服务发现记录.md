# AINovel v1.1 外部服务发现记录

## 1. 发现时间

- 日期：2026-02-16
- 目标主机：`192.168.1.4`

## 2. 端口扫描结果

对 `192.168.1.4` 做全端口扫描（`1-65535`）后，开放端口如下：

- `22`, `80`, `111`, `443`, `3000`, `3306`, `5900`, `6333`, `6334`, `6379`, `8000`, `60000`

结论：

- 默认 Consul 端口 `8500/8501/8600` 未对当前网络开放。
- 通过服务指纹确认 `60000` 提供 Consul HTTP API（返回 `/ui/` 跳转与 `/v1/*` 提示）。

## 3. Consul 可用入口

- 地址：`http://192.168.1.4:60000`
- 验证接口：
  - `/v1/status/leader`
  - `/v1/catalog/services`
  - `/v1/agent/self`

## 4. 已发现服务

## 4.1 Catalog 服务名

- `aienie-aiservice-grpc`
- `aienie-aiservice-http`
- `aienie-userservice-grpc`
- `aienie-userservice-http`
- `aienie-payservice-grpc`
- `aienie-payservice-http`

## 4.2 健康实例地址

- `aienie-userservice-grpc` -> `192.168.1.3:20002`
- `aienie-aiservice-grpc` -> `192.168.1.3:20003`
- `aienie-payservice-grpc` -> `192.168.1.3:20004`
- `aienie-userservice-http` -> `192.168.1.3:10002`
- `aienie-aiservice-http` -> `192.168.1.3:10003`
- `aienie-payservice-http` -> `192.168.1.3:10004`

## 5. gRPC 接口发现结果（grpcurl）

## 5.1 UserService (`192.168.1.3:20002`)

- `EmailVerificationService`
  - `SendEmailCode`
  - `VerifyEmailCode`
- `UserAuthService`
  - `LoginUser`
  - `RegisterUser`
  - `ResetPassword`
  - `ValidateSession`
- `UserBanService`
  - `BanUser`
  - `GetBanStatus`
  - `UnbanUser`
- `UserDirectoryService`
  - `GetUserBasic`
  - `BatchGetUserBasic`
- `UserPreferenceService`
  - `GetProjectPreferences`
  - `UpsertProjectPreferences`

## 5.2 AiService (`192.168.1.3:20003`)

- `AiGatewayService`
  - `ListModels`
  - `ChatCompletions`
  - `Embeddings`

## 5.3 PayService (`192.168.1.3:20004`)

- `BillingBalanceService`
  - `GetProjectBalance`
  - `GetPublicBalance`
- `BillingCheckinService`
  - `Checkin`
  - `GetCheckinStatus`
- `BillingConversionService`
  - `ConvertPublicToProject`
- `BillingGrantService`
  - `GrantProjectPermanentTokens`
  - `GrantPublicTokens`
- `BillingOnboardingService`
  - `EnsureUserInitialized`
- `BillingProjectModelQuotaService`
  - `CheckAndConsumeQuota`
- `BillingQueryService`
  - `ListLedgerEntries`
  - `ListUsageRecords`
- `BillingRedeemCodeService`
  - `RedeemCode`
  - `GetRedemptionHistory`
- `BillingUsageService`
  - `DeductPerCall`
  - `DeductUsage`

## 6. HTTP OpenAPI 可用性

- `http://192.168.1.3:10002/v3/api-docs`（UserService）可访问，`paths=30`
- `http://192.168.1.3:10003/v3/api-docs`（AiService）可访问，`paths=22`
- `http://192.168.1.3:10004/v3/api-docs`（PayService）可访问，`paths=18`

## 7. 对 AINovel 的直接影响

1. 服务发现配置应以 Consul `60000` 为准，而不是默认 `8500`。
2. UserService 在 Consul 的服务名为 `aienie-userservice-grpc`，与当前本项目默认 `userservice-grpc` 不一致，需在 v1.1 配置统一修正。
3. Ai/User/Pay 三方均已具备可用接口，不再需要 AINovel 本地重复实现模型管理、用户封禁、签到兑换、积分日志等能力。

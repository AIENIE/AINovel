# AINovel v1.1 开发规划

## 1. 文档信息

- 版本：v1.1（规划稿）
- 创建日期：2026-02-16
- 目标环境：
  - 测试服：`ainovel.seekerhut.com`
  - 正式服：`ainovel.aienie.com`
  - 前端端口：`10010`
  - 后端端口：`10011`

## 2. 前置检查结果

- `grpcurl` 可用：`grpcurl.exe v1.9.3`。
- 因此前置条件通过，可继续 v1.1 规划与开发。

## 3. 版本目标

v1.1 聚焦两件事：

1. 架构收敛：移除本地与第三方 `AiService`、`UserService`、`PayService` 重叠的功能与代码，保留 AINovel 核心业务（创作域）。
2. 接口标准化：补齐全部 REST 接口的 Swagger/OpenAPI 文档质量，达到可直接用于前后端联调与第三方接入的程度。

## 4. 现状基线（已扫描）

### 4.1 已识别的本地重叠能力

- AI 本地能力：
  - 后端包：`backend/src/main/java/com/ainovel/app/ai`
  - 相关接口：`/v1/ai/*`
  - 管理端模型管理：`/v1/admin/models*`
  - 设置中的 LLM 配置：`/v1/settings*`、`/v1/admin/system-config` 中 `llm*` 字段
- 用户本地能力：
  - 用户资料/汇总：`/v1/user/profile`、`/v1/user/summary`
  - 管理端用户管理：`/v1/admin/users*`、`/v1/admin/users/{id}/ban|unban`
- 支付/积分本地能力（归入 Pay 侧重叠）：
  - 用户积分相关：`/v1/user/check-in`、`/v1/user/redeem`
  - 管理端积分与兑换码：`/v1/admin/logs`、`/v1/admin/redeem-codes*`、`/v1/admin/users/{id}/grant-credits`
  - 相关实现：`backend/src/main/java/com/ainovel/app/economy`

### 4.2 管理界面中应优先下线项

- 模型管理页：`frontend/src/pages/Admin/ModelManager.tsx`
- 系统设置中的 LLM 配置段落：`frontend/src/pages/Admin/SystemSettings.tsx`
- 用户设置中的模型接入页：`frontend/src/pages/Settings/tabs/ModelSettings.tsx`
- 侧边栏入口（模型管理）：`frontend/src/components/layout/AdminLayout.tsx`

### 4.3 Swagger 现状

- 后端已引入：`springdoc-openapi-starter-webmvc-api`。
- 目前 Swagger 注解基本为空，接口说明主要依赖默认扫描。
- 当前 REST 接口规模：10 个 Controller，约 98 个端点。

## 5. 范围定义

### 5.1 In Scope（v1.1 必做）

1. 明确并落地“本地应移除”的功能清单（代码、接口、前端入口、配置字段、数据库表）。
2. 完成全量 REST 接口 Swagger 注解补齐：
   - 接口名称
   - 作用简介
   - 参数名与含义
   - 返回字段与含义
   - 示例请求/响应
3. 安全策略与文档端点联动校验（`/api/v3/api-docs` 与访问控制）。

### 5.2 Out of Scope（v1.1 不做）

1. 第三方服务本身功能改造。
2. 部署体系改造（Nginx/容器编排层大改）。
3. 与本次目标无关的 UI 风格重构。

## 6. 关键依赖与阻塞

### 6.1 已验证可用

- `grpcurl` 工具链可执行。
- Consul 可访问（外部端口为 `60000`，非默认 `8500`）。
- 三方服务注册已验证（Consul 服务名）：
  - `aienie-aiservice-grpc` / `aienie-aiservice-http`
  - `aienie-userservice-grpc` / `aienie-userservice-http`
  - `aienie-payservice-grpc` / `aienie-payservice-http`
- gRPC 反射可用，已通过 `grpcurl list/describe` 拉取服务与方法。

### 6.2 当前阻塞

- `192.168.1.4:8500` 对当前网络不可达（默认端口未开放），但 `192.168.1.4:60000` 可用，不构成阻塞。

### 6.3 阻塞解除后的发现步骤

1. 基于 `192.168.1.4:60000` 周期性刷新实例地址。
2. 对每个实例执行 `grpcurl list` 与 `grpcurl describe` 做版本比对。
3. 将外部接口能力映射到本地功能，形成最终删减清单并执行。

## 7. 里程碑

1. M1：完成重叠功能盘点与删减清单冻结（含风险评审）。
2. M2：完成后端重构（移除本地重叠实现，改为第三方服务调用或编排）。
3. M3：完成前端入口与页面收口（删除/隐藏不再支持能力）。
4. M4：完成 Swagger 全量补齐与示例校验。
5. M5：完成回归与发布验收（接口文档、权限、关键业务链路）。

## 8. 验收标准

1. 管理端不再出现 AI 接口配置、接口状态监控、模型池管理等本地能力入口。
2. 本地仓库不再保留与第三方三类服务重复的核心业务实现（按冻结清单验收）。
3. `/api/v3/api-docs` 中每个业务接口均具备可读 `summary/description` 与关键字段说明。
4. Swagger 文档包含可执行示例请求/响应，前后端联调可直接使用。
5. 文档与代码一致，无明显“文档有但接口不存在/接口存在但文档缺失”情况。

## 9. 风险控制

1. 功能误删风险：先冻结“删除矩阵”，每项必须有第三方能力映射证据。
2. 接口回归风险：删除前先标记废弃期，分批下线，保留最短观察窗口。
3. 文档维护风险：Swagger 注解模板化，纳入代码评审与测试门禁。

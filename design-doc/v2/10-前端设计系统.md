# 前端设计系统

## 文档信息

| 字段 | 值 |
|------|-----|
| 版本 | v2.0 |
| 日期 | 2026-02-17 |
| 优先级 | P2 |
| 关联模块 | 07-工作台与体验优化, 03-AI-Beta-Reader, 04-版本控制, 05-稿件导出 |
| 说明 | 跨模块前端设计规范，覆盖配色、排版、布局、动效、交互模式 |

---

## 1. 设计理念与原则

### 1.1 核心理念

AINovel v2 的前端设计系统围绕一个核心命题：**让作者沉浸于创作本身，而非工具操作**。所有视觉元素、交互模式、动效节奏都服务于这一目标。

### 1.2 四项设计原则

| 原则 | 含义 | 实践指导 |
|------|------|----------|
| **沉浸式写作体验为核心** | 编辑器是产品的灵魂，所有设计决策优先保障写作区域的视觉纯净度和操作流畅度 | 编辑器区域不使用强色彩干扰；工具面板可一键隐藏；字体、行高、间距均针对长时间阅读优化 |
| **内容优先，工具退后** | UI 元素在不需要时应尽量隐退，仅在用户需要时浮现 | 工具栏在编辑器聚焦时自动收敛；侧边栏支持折叠；浮动工具栏仅在选中文本时出现 |
| **克制而精致** | 拒绝过度装饰，每一个视觉元素都应有明确的功能目的 | 动效时长不超过 300ms；配色以中性暖色为主，仅在交互反馈时使用强调色；阴影层级不超过 3 级 |
| **桌面优先** | AINovel 是专业写作工具，桌面端是主战场 | 最小支持宽度 1280px；面板布局针对大屏优化；移动端仅提供降级的基础编辑能力 |

### 1.3 设计语言定位

AINovel 的视觉语言介于"文学编辑器"与"开发者 IDE"之间：

- **文学编辑器基因**：衬线字体用于正文、暖色调背景、纸张质感、舒适的行间距
- **IDE 基因**：多面板布局、命令面板、快捷键体系、状态栏、标签页切换
- **独特之处**：AI 交互层——内联建议、侧栏对话、智能分析报告

→ 见 07-工作台与体验优化.md § 1 了解工作台架构背景

---

## 2. 配色系统

### 2.1 主色板：暖白 + 鼠尾草绿

AINovel v2 采用"暖白 + 鼠尾草绿"配色方案。这一选择基于以下考量：

- **暖白背景**（而非纯白 `#FFFFFF`）：降低屏幕刺眼感，适合长时间写作
- **鼠尾草绿主色**：自然、沉静、不张扬，与文学创作的气质契合
- **木质棕辅助色**：增添温暖的手工质感，呼应传统书写工具的意象

完整色板定义如下：

| 色彩角色 | 色值 | 名称 | 用途 |
|----------|------|------|------|
| 背景色（主） | `#FAFAF8` | 暖白 | 页面主背景、编辑器背景 |
| 背景色（次） | `#F5F3EF` | 米色 | 卡片背景、面板背景、侧边栏背景 |
| 主色 | `#5B7F67` | 鼠尾草绿 | 按钮、链接、选中态、进度条、主要交互元素 |
| 辅助色 | `#8B6F4E` | 木质棕 | 次要按钮、标签、装饰性元素、强调信息 |
| 文字色（主） | `#2D3436` | 深炭 | 正文文字、标题 |
| 文字色（次） | `#636E72` | 中灰 | 次要文字、说明文字、时间戳 |
| 文字色（弱） | `#B2BEC3` | 浅灰 | 占位符文字、禁用态文字 |
| 边框色 | `#E8E4DE` | 暖灰 | 卡片边框、分割线、输入框边框 |
| 成功色 | `#5B7F67` | 鼠尾草绿（复用） | 保存成功、操作完成、正面反馈 |
| 警告色 | `#D4A574` | 琥珀 | 警告提示、需注意的状态 |
| 错误色 | `#C0392B` | 柔红 | 错误提示、删除确认、危险操作 |
| 信息色 | `#6B8FA3` | 雾蓝 | 信息提示、帮助文字、中性反馈 |

色彩对比度验证（WCAG 2.1 AA 标准，≥ 4.5:1）：

| 前景 | 背景 | 对比度 | 是否达标 |
|------|------|--------|----------|
| `#2D3436` 深炭 | `#FAFAF8` 暖白 | 12.8:1 | AA ✓ |
| `#636E72` 中灰 | `#FAFAF8` 暖白 | 5.2:1 | AA ✓ |
| `#5B7F67` 鼠尾草绿 | `#FAFAF8` 暖白 | 4.6:1 | AA ✓ |
| `#FFFFFF` 白色 | `#5B7F67` 鼠尾草绿 | 4.6:1 | AA ✓ |
| `#C0392B` 柔红 | `#FAFAF8` 暖白 | 5.1:1 | AA ✓ |

### 2.2 暗色主题色板

暗色主题在保持品牌识别度的同时，将所有色彩适配为低亮度环境：

| 色彩角色 | 色值 | 名称 | 说明 |
|----------|------|------|------|
| 背景色（主） | `#1A1B1E` | 深墨 | 页面主背景 |
| 背景色（次） | `#242528` | 炭灰 | 卡片、面板、侧边栏背景 |
| 背景色（三） | `#2D2E32` | 中炭 | 悬浮态背景、选中行背景 |
| 主色 | `#7FA88E` | 鼠尾草绿（提亮） | 主要交互元素，相比亮色主题提亮 20% |
| 辅助色 | `#C4A882` | 木质棕（提亮） | 次要交互元素，相比亮色主题提亮 25% |
| 文字色（主） | `#E8E4DE` | 暖白 | 正文文字 |
| 文字色（次） | `#9CA3AF` | 银灰 | 次要文字 |
| 文字色（弱） | `#6B7280` | 暗灰 | 占位符、禁用态 |
| 边框色 | `#3A3B3E` | 深灰边框 | 分割线、卡片边框 |
| 成功色 | `#7FA88E` | 鼠尾草绿（提亮） | 正面反馈 |
| 警告色 | `#E0B687` | 琥珀（提亮） | 警告提示 |
| 错误色 | `#E74C3C` | 亮红 | 错误提示 |
| 信息色 | `#89B4C8` | 雾蓝（提亮） | 信息提示 |

暗色主题设计要点：

- 背景不使用纯黑 `#000000`，而是带微暖色调的深灰，减少视觉疲劳
- 文字不使用纯白 `#FFFFFF`，而是偏暖的 `#E8E4DE`，与亮色主题的背景色形成呼应
- 主色和辅助色均提亮处理，确保在深色背景上的可读性和辨识度

### 2.3 羊皮纸主题色板

羊皮纸主题（Parchment）是 v1 已有的特色主题，v2 在保留其核心气质的基础上进行精细化调整，使其与新设计系统的色彩体系对齐：

| 色彩角色 | 色值 | 名称 | 说明 |
|----------|------|------|------|
| 背景色（主） | `#F0EDE8` | 羊皮纸 | 模拟古旧纸张的暖黄色调 |
| 背景色（次） | `#E8E2D8` | 深羊皮纸 | 卡片、面板背景 |
| 背景色（三） | `#DDD6CA` | 旧纸 | 悬浮态、选中行 |
| 主色 | `#5B7F67` | 鼠尾草绿 | 与默认主题保持一致 |
| 辅助色 | `#8B6F4E` | 木质棕 | 在羊皮纸背景上更显自然 |
| 文字色（主） | `#3C3226` | 墨褐 | 模拟墨水在旧纸上的色泽 |
| 文字色（次） | `#6B5D4F` | 淡墨 | 次要文字 |
| 边框色 | `#D4CCBF` | 纸边 | 边框、分割线 |

→ 见 07-工作台与体验优化.md § 3.8 了解主题切换的实现机制

### 2.4 Hacker 主题色板

Hacker 主题（暗黑极客风）是 v1 已有的特色主题，v2 进行精细化调整：

| 色彩角色 | 色值 | 名称 | 说明 |
|----------|------|------|------|
| 背景色（主） | `#0D1117` | 深空黑 | GitHub Dark 风格的深色背景 |
| 背景色（次） | `#161B22` | 夜幕 | 卡片、面板背景 |
| 背景色（三） | `#21262D` | 暗板岩 | 悬浮态、选中行 |
| 主色 | `#58A6FF` | 电光蓝 | 链接、主要交互元素 |
| 辅助色 | `#7EE787` | 终端绿 | 成功状态、代码高亮 |
| 文字色（主） | `#C9D1D9` | 银白 | 正文文字 |
| 文字色（次） | `#8B949E` | 钢灰 | 次要文字 |
| 边框色 | `#30363D` | 暗边框 | 分割线、卡片边框 |
| 警告色 | `#D29922` | 终端黄 | 警告提示 |
| 错误色 | `#F85149` | 终端红 | 错误提示 |

### 2.5 CSS 变量定义

所有色彩通过 CSS 自定义属性（Custom Properties）定义，遵循 shadcn/ui 的 HSL 值约定（不含 `hsl()` 函数包裹，由 Tailwind 在使用时自动包裹）。这使得主题切换只需切换 `:root` 上的变量集合。

**默认主题（亮色）：**

```css
:root {
  /* 基础色 */
  --background: 50 20% 97%;           /* #FAFAF8 暖白 */
  --foreground: 192 10% 20%;          /* #2D3436 深炭 */

  /* 主色 */
  --primary: 147 16% 43%;             /* #5B7F67 鼠尾草绿 */
  --primary-foreground: 0 0% 100%;    /* #FFFFFF 白色 */

  /* 辅助色 */
  --secondary: 30 29% 43%;            /* #8B6F4E 木质棕 */
  --secondary-foreground: 0 0% 100%;  /* #FFFFFF 白色 */

  /* 静音色 */
  --muted: 35 18% 95%;                /* #F5F3EF 米色 */
  --muted-foreground: 195 6% 42%;     /* #636E72 中灰 */

  /* 强调色 */
  --accent: 35 18% 92%;               /* 略深于 muted */
  --accent-foreground: 192 10% 20%;   /* #2D3436 深炭 */

  /* 边框与焦点环 */
  --border: 30 14% 89%;               /* #E8E4DE 暖灰 */
  --input: 30 14% 89%;                /* 同 border */
  --ring: 147 16% 43%;                /* 同 primary */

  /* 功能色 */
  --destructive: 6 63% 46%;           /* #C0392B 柔红 */
  --destructive-foreground: 0 0% 100%;

  /* 卡片 */
  --card: 35 20% 95%;                 /* #F5F3EF 米色 */
  --card-foreground: 192 10% 20%;     /* #2D3436 深炭 */

  /* 弹出层 */
  --popover: 35 20% 95%;
  --popover-foreground: 192 10% 20%;

  /* 侧边栏 */
  --sidebar-background: 35 20% 95%;
  --sidebar-foreground: 192 10% 20%;
  --sidebar-primary: 147 16% 43%;
  --sidebar-accent: 35 18% 92%;
  --sidebar-border: 30 14% 89%;

  /* 圆角 */
  --radius: 0.5rem;
}
```

**暗色主题：**

```css
.dark {
  --background: 228 7% 11%;            /* #1A1B1E 深墨 */
  --foreground: 30 14% 89%;            /* #E8E4DE 暖白 */

  --primary: 147 16% 58%;              /* #7FA88E 鼠尾草绿提亮 */
  --primary-foreground: 228 7% 11%;

  --secondary: 30 29% 64%;             /* #C4A882 木质棕提亮 */
  --secondary-foreground: 228 7% 11%;

  --muted: 225 6% 15%;                 /* #242528 炭灰 */
  --muted-foreground: 218 11% 65%;     /* #9CA3AF 银灰 */

  --accent: 225 5% 18%;                /* #2D2E32 中炭 */
  --accent-foreground: 30 14% 89%;

  --border: 225 4% 23%;                /* #3A3B3E 深灰边框 */
  --input: 225 4% 23%;
  --ring: 147 16% 58%;

  --destructive: 0 72% 57%;            /* #E74C3C 亮红 */
  --destructive-foreground: 0 0% 100%;

  --card: 225 6% 15%;
  --card-foreground: 30 14% 89%;

  --popover: 225 6% 15%;
  --popover-foreground: 30 14% 89%;

  --sidebar-background: 225 6% 13%;
  --sidebar-foreground: 30 14% 89%;
  --sidebar-primary: 147 16% 58%;
  --sidebar-accent: 225 5% 18%;
  --sidebar-border: 225 4% 23%;
}
```

**羊皮纸主题：**

```css
.theme-parchment {
  --background: 35 18% 93%;            /* #F0EDE8 */
  --foreground: 28 24% 19%;            /* #3C3226 */

  --primary: 147 16% 43%;              /* #5B7F67 */
  --primary-foreground: 0 0% 100%;

  --secondary: 30 29% 43%;             /* #8B6F4E */
  --secondary-foreground: 0 0% 100%;

  --muted: 33 18% 88%;                 /* #E8E2D8 */
  --muted-foreground: 24 16% 37%;      /* #6B5D4F */

  --border: 30 14% 80%;                /* #D4CCBF */
  --card: 33 18% 88%;
  --card-foreground: 28 24% 19%;
}
```

**Hacker 主题：**

```css
.theme-hacker {
  --background: 215 28% 7%;            /* #0D1117 */
  --foreground: 210 9% 81%;            /* #C9D1D9 */

  --primary: 212 100% 67%;             /* #58A6FF */
  --primary-foreground: 215 28% 7%;

  --secondary: 130 55% 70%;            /* #7EE787 */
  --secondary-foreground: 215 28% 7%;

  --muted: 215 19% 11%;                /* #161B22 */
  --muted-foreground: 212 9% 58%;      /* #8B949E */

  --border: 215 14% 21%;               /* #30363D */
  --card: 215 19% 11%;
  --card-foreground: 210 9% 81%;
}
```

### 2.6 Tailwind 配置集成

在 `tailwind.config.ts` 中将 CSS 变量映射为 Tailwind 工具类：

```typescript
// tailwind.config.ts
import type { Config } from "tailwindcss";

const config: Config = {
  darkMode: ["class"],
  theme: {
    extend: {
      colors: {
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
      },
    },
  },
};
```

---

## 3. 排版系统

### 3.1 字体栈

AINovel v2 使用三套字体栈，分别服务于不同场景：

| 用途 | 字体栈 | 说明 |
|------|--------|------|
| 编辑器正文 | `"Noto Serif SC", "Source Han Serif SC", "Songti SC", Georgia, "Times New Roman", serif` | 衬线字体，营造沉浸式阅读体验，中文优先使用思源宋体 |
| UI 界面 | `Inter, "Noto Sans SC", "PingFang SC", "Microsoft YaHei", system-ui, -apple-system, sans-serif` | 无衬线字体，清晰锐利，适合界面元素和工具文字 |
| 代码/技术 | `"JetBrains Mono", "Fira Code", "Source Code Pro", "Cascadia Code", monospace` | 等宽字体，用于代码片段、技术标注、JSON 预览等 |

字体加载策略：

```css
/* 编辑器字体 - 通过 Google Fonts 加载 */
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap');

/* UI 字体 - 通过 Google Fonts 加载 */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

/* 代码字体 - 通过 Google Fonts 加载 */
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap');
```

CSS 变量定义：

```css
:root {
  --font-editor: "Noto Serif SC", "Source Han Serif SC", "Songti SC",
                 Georgia, "Times New Roman", serif;
  --font-ui: Inter, "Noto Sans SC", "PingFang SC",
             "Microsoft YaHei", system-ui, -apple-system, sans-serif;
  --font-mono: "JetBrains Mono", "Fira Code", "Source Code Pro",
               "Cascadia Code", monospace;
}
```

### 3.2 字号体系

基于 4px 基准网格的字号体系，覆盖从最小标注到最大标题的所有场景：

| Token | 字号 | 行高 | 用途 |
|-------|------|------|------|
| `text-xs` | 12px (0.75rem) | 1.5 (18px) | 徽章文字、时间戳、脚注 |
| `text-sm` | 14px (0.875rem) | 1.5 (21px) | UI 正文、按钮文字、表单标签 |
| `text-base` | 16px (1rem) | 1.5 (24px) | UI 大段文字、对话框正文 |
| `text-lg` | 18px (1.125rem) | 1.8 (32.4px) | **编辑器正文**（核心字号） |
| `text-xl` | 20px (1.25rem) | 1.6 (32px) | 三级标题（H3）、卡片标题 |
| `text-2xl` | 24px (1.5rem) | 1.4 (33.6px) | 二级标题（H2）、面板标题 |
| `text-3xl` | 30px (1.875rem) | 1.3 (39px) | 一级标题（H1）、页面标题 |
| `text-4xl` | 36px (2.25rem) | 1.2 (43.2px) | 特大标题、仪表盘欢迎语 |

编辑器内部的标题层级：

```css
.editor-content h1 { font-size: 1.875rem; font-weight: 700; margin-top: 2em; margin-bottom: 0.8em; }
.editor-content h2 { font-size: 1.5rem;   font-weight: 600; margin-top: 1.6em; margin-bottom: 0.6em; }
.editor-content h3 { font-size: 1.25rem;  font-weight: 600; margin-top: 1.4em; margin-bottom: 0.5em; }
.editor-content p   { font-size: 1.125rem; font-weight: 400; margin-bottom: 1em; }
```

### 3.3 行高与间距

行高和间距是影响阅读舒适度的关键参数，编辑器和 UI 采用不同的策略：

**编辑器区域：**

| 参数 | 值 | 说明 |
|------|-----|------|
| 正文行高 | 1.8 | 宽松行距，适合长时间中文阅读 |
| 段落间距 | 1em (18px) | 段落之间留出一个正文字号的空白 |
| 章节间距 | 2em (36px) | 章节标题前后留出更大空白 |
| 编辑器内边距 | 48px 64px | 上下 48px，左右 64px，营造纸张感 |
| 最大内容宽度 | 48rem (768px) | 限制每行字数在 35-42 个中文字符，符合最佳阅读宽度 |

**UI 区域：**

| 参数 | 值 | 说明 |
|------|-----|------|
| 正文行高 | 1.5 | 标准 UI 行距 |
| 紧凑行高 | 1.25 | 用于表格、列表等紧凑场景 |
| 组件间距 | 基于 4px 网格 | 4/8/12/16/24/32/48px |
| 面板内边距 | 16px (p-4) | 面板内容区域的标准内边距 |

---

## 4. 布局框架

### 4.1 IDE 多面板架构

AINovel v2 工作台采用类 IDE 的多面板架构，由 `react-resizable-panels` 驱动。整体布局结构如下：

```
┌─────────────────────────────────────────────────────────────────┐
│  AppLayout Sidebar (collapsible: 48px collapsed / 240px open)  │
│  ┌──────┐                                                      │
│  │ Logo │  项目名称                                             │
│  ├──────┤                                                      │
│  │  📁  │  故事管理                                             │
│  │  ✏️  │  工作台                                               │
│  │  📊  │  分析报告                                             │
│  │  ⚙️  │  设置                                                │
│  │      │                                                      │
│  │      │                                                      │
│  │  👤  │  用户头像                                             │
│  └──────┘                                                      │
├─────────────────────────────────────────────────────────────────┤
│ ┌────────────┬──────────────────────────┬────────────────────┐  │
│ │ Left Panel │ Center Panel             │ Right Panel        │  │
│ │ (20%)      │ (55%)                    │ (25%)              │  │
│ │ min: 15%   │ min: 30%                 │ min: 15%           │  │
│ │ max: 35%   │                          │ max: 40%           │  │
│ │            │                          │                    │  │
│ │ ┌────────┐ │ ┌──────────────────────┐ │ ┌──────────────┐  │  │
│ │ │Outline │ │ │ EditorTabs           │ │ │ TabGroup     │  │  │
│ │ │Tree    │ │ │ [Ch1] [Ch2] [Ch3]   │ │ │ [Copilot]    │  │  │
│ │ │        │ │ ├──────────────────────┤ │ │ [Context]    │  │  │
│ │ │ Ch 1   │ │ │                      │ │ │ [Graph]      │  │  │
│ │ │  Sc 1  │ │ │  TiptapEditor        │ │ │ [Version]    │  │  │
│ │ │  Sc 2  │ │ │                      │ │ │ [Analysis]   │  │  │
│ │ │ Ch 2   │ │ │  (正文编辑区域)       │ │ │              │  │  │
│ │ │  Sc 1  │ │ │                      │ │ │  当前标签内容  │  │  │
│ │ ├────────┤ │ │                      │ │ │              │  │  │
│ │ │Lorebook│ │ │                      │ │ │              │  │  │
│ │ │Quick   │ │ │                      │ │ │              │  │  │
│ │ │Panel   │ │ │                      │ │ │              │  │  │
│ │ └────────┘ │ └──────────────────────┘ │ └──────────────┘  │  │
│ └────────────┴──────────────────────────┴────────────────────┘  │
│ ┌───────────────────────────────────────────────────────────┐   │
│ │ StatusBar (32px)                                          │   │
│ │ 字数: 3,421 | 选中: 128 | 行 42, 列 15 | 已保存 | 目标: 67% │   │
│ └───────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

面板组件层级结构：

```typescript
// 工作台布局组件树
<AppLayout>                              // 顶层布局，含侧边栏
  <Sidebar collapsible="icon">           // 左侧导航栏
    <SidebarContent />
  </Sidebar>
  <main>
    <ResizablePanelGroup direction="vertical">
      <ResizablePanel>                   // 主工作区
        <ResizablePanelGroup direction="horizontal">
          <ResizablePanel id="left">     // 左面板
            <LeftPanelTabs />
          </ResizablePanel>
          <ResizableHandle />
          <ResizablePanel id="center">   // 中央编辑器
            <EditorTabs />
            <TiptapEditor />
          </ResizablePanel>
          <ResizableHandle />
          <ResizablePanel id="right">    // 右面板
            <RightPanelTabs />
          </ResizablePanel>
        </ResizablePanelGroup>
      </ResizablePanel>
      <StatusBar />                      // 底部状态栏
    </ResizablePanelGroup>
  </main>
</AppLayout>
```

→ 见 07-工作台与体验优化.md § 3.2 了解面板布局的详细实现

### 4.2 面板行为规范

| 面板 | 默认宽度 | 最小宽度 | 最大宽度 | 折叠宽度 | 折叠触发 |
|------|----------|----------|----------|----------|----------|
| 左面板 | 20% | 15% | 35% | 0% (隐藏) | 双击拖拽手柄 / 快捷键 `Ctrl+B` |
| 中央面板 | 55% | 30% | 100% | — | 不可折叠 |
| 右面板 | 25% | 15% | 40% | 0% (隐藏) | 双击拖拽手柄 / 快捷键 `Ctrl+J` |
| 侧边栏 | 240px | 48px | 320px | 48px (仅图标) | 点击折叠按钮 / 快捷键 `Ctrl+\` |
| 状态栏 | 32px | 32px | 32px | 0% (隐藏) | 设置中关闭 |

面板交互细节：

- **拖拽调整**：拖拽手柄（`ResizableHandle`）实时调整面板宽度，无动画延迟
- **双击折叠**：双击拖拽手柄可快速折叠/展开对应面板
- **折叠动画**：面板折叠/展开使用 200ms 的 `ease-out` 过渡
- **状态持久化**：面板宽度、可见性、激活标签页等状态通过 API 持久化到 `workspace_layouts` 表
- **拖拽手柄样式**：宽度 4px，默认透明，hover 时显示 `var(--border)` 色，拖拽时显示 `var(--primary)` 色

### 4.3 预设布局方案

系统内置四套布局预设，用户可一键切换，也可基于预设自定义调整后另存为新布局：

#### 4.3.1 写作模式（默认）

```
┌──────────┬────────────────────────┬──────────────┐
│ Left 20% │ Center 55%             │ Right 25%    │
│ Outline  │ Editor                 │ Copilot      │
│ Tree     │                        │ (AI 对话)    │
└──────────┴────────────────────────┴──────────────┘
```

- 左面板：大纲树，快速导航章节/场景
- 中央面板：编辑器，主要写作区域
- 右面板：Copilot 标签页激活，随时与 AI 对话

#### 4.3.2 校对模式

```
┌────────┬──────────────────┬────────────────────┐
│Left 15%│ Center 45%       │ Right 40%          │
│Outline │ Editor           │ [Analysis][Version]│
│(紧凑)  │                  │ Beta Reader 报告   │
└────────┴──────────────────┴────────────────────┘
```

- 左面板：紧凑大纲，仅显示章节列表
- 中央面板：编辑器，用于根据反馈修改
- 右面板：加宽，显示 Analysis（Beta Reader 报告）和 Version（版本对比）标签页

#### 4.3.3 构思模式

```
┌──────────────┬────────────────┬──────────────┐
│ Left 30%     │ Center 40%     │ Right 30%    │
│ [Lorebook]   │ Editor         │ [Graph]      │
│ [Outline]    │                │ [Copilot]    │
│ 角色/世界设定 │                │ 知识图谱      │
└──────────────┴────────────────┴──────────────┘
```

- 左面板：加宽，Lorebook 快速面板 + 大纲树
- 中央面板：编辑器，用于记录灵感和草稿
- 右面板：知识图谱可视化 + AI 对话

#### 4.3.4 专注模式

```
┌─────────────────────────────────────────────┐
│                                             │
│                                             │
│          Center 100%                        │
│          Editor Only                        │
│          max-width: 48rem                   │
│          typewriter scroll                  │
│                                             │
│                                             │
│                              [退出] 1,234字 │
└─────────────────────────────────────────────┘
```

- 全屏，隐藏侧边栏、左右面板、状态栏
- 编辑器居中，最大宽度 48rem，上下大量留白
- 打字机滚动：当前编辑行始终保持在视口垂直中心
- 右下角半透明显示：退出按钮 + 当前字数
- `Esc` 键退出专注模式
- 可选：微妙的纸张纹理背景（通过设置开关）

### 4.4 专注模式详细设计

专注模式是 AINovel 的核心差异化体验，需要精心设计每一个细节：

```typescript
// ZenMode 组件接口
interface ZenModeProps {
  isActive: boolean;
  onExit: () => void;
  showWordCount: boolean;
  typewriterScroll: boolean;
  backgroundTexture: 'none' | 'paper' | 'linen';
}
```

**视觉规格：**

| 参数 | 值 | 说明 |
|------|-----|------|
| 编辑器最大宽度 | 48rem (768px) | 最佳阅读宽度 |
| 垂直内边距 | 30vh | 上下各留 30% 视口高度 |
| 水平居中 | `margin: 0 auto` | 编辑器水平居中 |
| 背景色 | `var(--background)` | 跟随当前主题 |
| 退出按钮 | 右下角，距边缘 24px | `opacity: 0.3`，hover 时 `opacity: 0.8` |
| 字数显示 | 退出按钮左侧 | `opacity: 0.3`，`font-variant-numeric: tabular-nums` |
| 进入动画 | 300ms | 面板滑出 + 编辑器居中 + 背景淡入 |
| 退出动画 | 200ms | 反向播放进入动画 |

**打字机滚动实现：**

```typescript
// 打字机滚动：保持光标所在行在视口垂直中心
const useTypewriterScroll = (editor: Editor) => {
  useEffect(() => {
    if (!editor) return;

    const handleUpdate = () => {
      const { from } = editor.state.selection;
      const coords = editor.view.coordsAtPos(from);
      const viewportCenter = window.innerHeight / 2;
      const offset = coords.top - viewportCenter;

      window.scrollBy({
        top: offset,
        behavior: 'smooth',
      });
    };

    editor.on('selectionUpdate', handleUpdate);
    return () => editor.off('selectionUpdate', handleUpdate);
  }, [editor]);
};
```

→ 见 07-工作台与体验优化.md § 3.5 了解专注模式的完整实现

---

## 5. 组件设计规范

### 5.1 按钮 (Button)

按钮是最基础的交互组件，AINovel v2 定义以下变体：

**变体：**

| 变体 | 背景 | 文字 | 边框 | 用途 |
|------|------|------|------|------|
| `primary` | `var(--primary)` 鼠尾草绿 | 白色 | 无 | 主要操作：保存、发布、确认 |
| `secondary` | `var(--secondary)` 木质棕 | 白色 | 无 | 次要操作：导出、分享 |
| `ghost` | 透明 | `var(--foreground)` | 无 | 工具栏按钮、面板内操作 |
| `outline` | 透明 | `var(--foreground)` | `var(--border)` | 取消、返回等中性操作 |
| `destructive` | `var(--destructive)` | 白色 | 无 | 删除、移除等危险操作 |
| `link` | 透明 | `var(--primary)` | 无 | 内联链接样式按钮 |

**尺寸：**

| 尺寸 | 高度 | 内边距 | 字号 | 用途 |
|------|------|--------|------|------|
| `sm` | 28px | 8px 12px | 12px | 紧凑区域、表格内操作 |
| `default` | 36px | 8px 16px | 14px | 标准按钮 |
| `lg` | 44px | 12px 24px | 16px | 突出操作、对话框主按钮 |
| `icon` | 36px × 36px | 0 | — | 图标按钮（工具栏） |
| `icon-sm` | 28px × 28px | 0 | — | 小图标按钮 |

**通用样式：**

```css
.btn {
  border-radius: 6px;                          /* rounded-md */
  font-weight: 500;                            /* font-medium */
  transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  white-space: nowrap;
  user-select: none;
}

.btn:focus-visible {
  outline: 2px solid hsl(var(--ring));
  outline-offset: 2px;
}

.btn:disabled {
  opacity: 0.5;
  pointer-events: none;
}
```

### 5.2 卡片 (Card)

卡片用于承载独立的内容块，如项目卡片、报告卡片、Lorebook 条目等。

**基础样式：**

```css
.card {
  background: hsl(var(--card));
  color: hsl(var(--card-foreground));
  border: 1px solid hsl(var(--border));
  border-radius: 8px;                          /* rounded-lg */
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);  /* shadow-sm */
  padding: 16px;                               /* p-4 */
  transition: box-shadow 200ms ease;
}

.card:hover {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);  /* 悬浮时阴影加深 */
}

.card-interactive {
  cursor: pointer;
}

.card-interactive:hover {
  border-color: hsl(var(--primary) / 0.3);     /* 可交互卡片 hover 时边框变色 */
}
```

**卡片内部结构：**

```typescript
interface CardStructure {
  header?: {
    title: string;
    description?: string;
    action?: ReactNode;        // 右上角操作按钮
  };
  content: ReactNode;
  footer?: {
    left?: ReactNode;          // 左侧信息（如时间戳）
    right?: ReactNode;         // 右侧操作按钮组
  };
}
```

### 5.3 输入框 (Input)

**基础样式：**

```css
.input {
  background: hsl(var(--background));
  color: hsl(var(--foreground));
  border: 1px solid hsl(var(--border));
  border-radius: 6px;                          /* rounded-md */
  height: 36px;
  padding: 0 12px;
  font-size: 14px;
  line-height: 1.5;
  transition: border-color 150ms ease, box-shadow 150ms ease;
  width: 100%;
}

.input::placeholder {
  color: hsl(var(--muted-foreground));
}

.input:focus {
  outline: none;
  border-color: hsl(var(--ring));
  box-shadow: 0 0 0 2px hsl(var(--ring) / 0.2);
}

.input:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
```

**输入框变体：**

| 变体 | 说明 | 特殊样式 |
|------|------|----------|
| `default` | 标准输入框 | 如上 |
| `textarea` | 多行文本 | `min-height: 80px; resize: vertical` |
| `search` | 搜索框 | 左侧搜索图标，右侧清除按钮 |
| `inline` | 内联编辑 | 无边框，hover 时显示底部虚线 |

### 5.4 对话框/弹窗 (Dialog)

**遮罩层：**

```css
.dialog-overlay {
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(4px);                  /* backdrop-blur-sm */
  position: fixed;
  inset: 0;
  z-index: 50;
  animation: fade-in 200ms ease;
}
```

**内容区域：**

```css
.dialog-content {
  background: hsl(var(--card));
  color: hsl(var(--card-foreground));
  border-radius: 12px;                         /* rounded-xl */
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  padding: 24px;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 51;
  animation: dialog-enter 200ms ease;
}

@keyframes dialog-enter {
  from {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}
```

**尺寸预设：**

| 尺寸 | 最大宽度 | 用途 |
|------|----------|------|
| `sm` | 400px | 确认对话框、简单表单 |
| `md` | 500px | 标准表单、设置面板 |
| `lg` | 700px | 复杂表单、预览面板 |
| `xl` | 900px | 导出预览、版本对比 |
| `full` | `calc(100vw - 64px)` | 全屏对话框（知识图谱） |

### 5.5 标签页 (Tabs)

AINovel v2 使用两种标签页风格：

**下划线风格（Underline）—— 用于右面板标签组：**

```css
.tabs-underline .tab-trigger {
  padding: 8px 16px;
  font-size: 13px;
  font-weight: 500;
  color: hsl(var(--muted-foreground));
  border-bottom: 2px solid transparent;
  transition: all 150ms ease;
  background: transparent;
}

.tabs-underline .tab-trigger[data-state="active"] {
  color: hsl(var(--foreground));
  border-bottom-color: hsl(var(--primary));
}

.tabs-underline .tab-trigger:hover:not([data-state="active"]) {
  color: hsl(var(--foreground));
  background: hsl(var(--accent));
}
```

**药丸风格（Pill）—— 用于设置页面、配置区域：**

```css
.tabs-pill .tab-list {
  background: hsl(var(--muted));
  border-radius: 8px;
  padding: 4px;
  display: inline-flex;
  gap: 4px;
}

.tabs-pill .tab-trigger {
  padding: 6px 16px;
  font-size: 13px;
  font-weight: 500;
  border-radius: 6px;
  color: hsl(var(--muted-foreground));
  transition: all 150ms ease;
}

.tabs-pill .tab-trigger[data-state="active"] {
  background: hsl(var(--background));
  color: hsl(var(--foreground));
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
}
```

### 5.6 徽章 (Badge)

**变体：**

| 变体 | 背景 | 文字 | 用途 |
|------|------|------|------|
| `default` | `var(--primary)` | 白色 | 默认标签 |
| `secondary` | `var(--secondary)` | 白色 | 次要标签 |
| `outline` | 透明 | `var(--foreground)` | 轮廓标签 |
| `destructive` | `var(--destructive)` | 白色 | 错误/警告标签 |

**Lorebook 分类徽章：**

Lorebook 条目按类型使用不同颜色的圆点 + 文字标签：

```css
.badge-category {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 2px 10px;
  border-radius: 9999px;                       /* rounded-full */
  font-size: 12px;
  font-weight: 500;
}

.badge-category::before {
  content: '';
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.badge-category--character::before { background: #5B7F67; }  /* 鼠尾草绿 */
.badge-category--location::before  { background: #6B8FA3; }  /* 雾蓝 */
.badge-category--event::before     { background: #D4A574; }  /* 琥珀 */
.badge-category--item::before      { background: #5BA37F; }  /* 翡翠 */
.badge-category--concept::before   { background: #8B6FA3; }  /* 紫藤 */
```

**状态徽章：**

| 状态 | 背景色 | 文字色 | 用途 |
|------|--------|--------|------|
| 草稿 | `#F5F3EF` | `#636E72` | 章节状态：草稿 |
| 进行中 | `#EBF5EE` | `#5B7F67` | 章节状态：写作中 |
| 已完成 | `#5B7F67` | `#FFFFFF` | 章节状态：已完成 |
| 需修改 | `#FDF2E9` | `#D4A574` | 章节状态：需修改 |

---

## 6. 动效规范

### 6.1 动效原则

AINovel 的动效设计遵循"克制微动效"原则：

1. **有目的**：每个动效都应传达状态变化或引导注意力，不做纯装饰性动效
2. **高性能**：所有动效控制在 200ms 以内完成（模态框除外，允许 300ms），避免主线程阻塞
3. **可关闭**：尊重 `prefers-reduced-motion` 系统设置，为运动敏感用户提供无动效体验
4. **一致性**：相同类型的交互使用相同的动效参数

```css
/* 全局动效关闭支持 */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}
```

### 6.2 过渡时间

| 级别 | 时长 | 用途 |
|------|------|------|
| Fast | 100ms | hover 状态、focus ring、按钮背景色变化、工具提示显示 |
| Normal | 200ms | 面板折叠/展开、淡入淡出、标签页切换、卡片阴影变化 |
| Slow | 300ms | 模态框开关、页面级过渡、专注模式进入/退出 |

CSS 变量定义：

```css
:root {
  --duration-fast: 100ms;
  --duration-normal: 200ms;
  --duration-slow: 300ms;
}
```

### 6.3 缓动函数

| 名称 | 值 | 用途 |
|------|-----|------|
| `ease-default` | `cubic-bezier(0.4, 0, 0.2, 1)` | 通用缓动，适用于大多数过渡 |
| `ease-enter` | `cubic-bezier(0, 0, 0.2, 1)` | 元素进入（从无到有），减速进入 |
| `ease-exit` | `cubic-bezier(0.4, 0, 1, 1)` | 元素退出（从有到无），加速退出 |
| `ease-bounce` | `cubic-bezier(0.34, 1.56, 0.64, 1)` | 轻微弹跳，用于成就达成等正面反馈 |

```css
:root {
  --ease-default: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-enter: cubic-bezier(0, 0, 0.2, 1);
  --ease-exit: cubic-bezier(0.4, 0, 1, 1);
  --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
}
```

### 6.4 具体动效清单

| 交互场景 | 动效类型 | 时长 | 缓动 | 说明 |
|----------|----------|------|------|------|
| 面板拖拽调整 | 实时跟随 | 0ms | — | 无动画，实时响应鼠标位置 |
| 面板折叠/展开 | 宽度滑动 | 200ms | `ease-default` | 面板宽度从当前值过渡到 0 或目标值 |
| 模态框打开 | 淡入 + 缩放 | 200ms | `ease-enter` | `opacity: 0→1` + `scale(0.95→1)` |
| 模态框关闭 | 淡出 + 缩放 | 150ms | `ease-exit` | `opacity: 1→0` + `scale(1→0.95)` |
| Toast 通知 | 滑入 | 200ms | `ease-enter` | 从右上角滑入，`translateX(100%→0)` |
| Toast 消失 | 滑出 | 150ms | `ease-exit` | 向右滑出 + 淡出 |
| 标签页切换 | 淡入淡出 | 150ms | `ease-default` | 旧内容淡出，新内容淡入 |
| 按钮 hover | 背景色变化 | 100ms | `ease-default` | 背景色平滑过渡 |
| 卡片 hover | 阴影变化 | 200ms | `ease-default` | `box-shadow` 平滑加深 |
| 加载骨架屏 | 脉冲 | 2000ms | `ease-in-out` | 背景色在 `var(--muted)` 和 `var(--accent)` 间循环 |
| 写作目标达成 | 彩纸爆发 | 300ms | `ease-bounce` | 使用 canvas-confetti 库，从目标进度条位置爆发 |
| 保存指示器 | 淡入→淡出 | 100ms in + 2s hold + 100ms out | `ease-enter` | 绿色圆点淡入，停留 2s 后淡出 |
| 侧边栏折叠 | 宽度过渡 | 200ms | `ease-default` | `width: 240px→48px`，图标保持居中 |
| 下拉菜单 | 缩放 + 淡入 | 150ms | `ease-enter` | `scale(0.95→1)` + `opacity: 0→1` |
| 工具提示 | 淡入 | 100ms | `ease-enter` | 延迟 500ms 后淡入显示 |

**骨架屏动画实现：**

```css
@keyframes skeleton-pulse {
  0%, 100% {
    background-color: hsl(var(--muted));
  }
  50% {
    background-color: hsl(var(--accent));
  }
}

.skeleton {
  animation: skeleton-pulse 2s ease-in-out infinite;
  border-radius: 4px;
}
```

---

## 7. AI 交互设计

AI 交互是 AINovel 的核心差异化能力。设计系统需要为 AI 功能定义统一的视觉语言和交互模式，确保 AI 能力自然融入写作流程而不喧宾夺主。

### 7.1 内联 AI 建议（Ghost Text）

类似 GitHub Copilot 的内联建议体验：AI 在光标后以半透明文字显示续写建议，作者可一键接受或忽略。

**触发条件：**

- 作者停止输入 1.5 秒后自动触发（时间可在设置中配置，范围 0.5s - 5s）
- 光标位于段落末尾或句子末尾时触发概率更高
- 可通过快捷键 `Alt+\` 手动触发
- 可在设置中完全关闭

**视觉规格：**

```css
.ghost-text {
  color: hsl(var(--muted-foreground));
  opacity: 0.4;
  font-style: italic;
  font-family: var(--font-editor);             /* 与正文同字体 */
  font-size: inherit;                          /* 与正文同字号 */
  pointer-events: none;                        /* 不可选中 */
  user-select: none;
}
```

**交互操作：**

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| 接受全部 | `Tab` | 接受整段建议文字 |
| 接受一个词 | `Ctrl+→` | 仅接受建议的下一个词 |
| 拒绝 | `Esc` | 清除当前建议 |
| 忽略 | 继续输入 | 建议自动消失，以用户输入为准 |

**Tiptap 扩展接口：**

```typescript
// GhostText Tiptap Extension
interface GhostTextOptions {
  enabled: boolean;
  debounceMs: number;           // 触发延迟，默认 1500
  maxTokens: number;            // 最大建议 token 数，默认 100
  onTrigger: (context: {
    textBefore: string;
    textAfter: string;
    cursorPosition: number;
  }) => Promise<string>;        // AI 生成回调
  onAccept: (text: string) => void;
  onReject: () => void;
}
```

### 7.2 选中文本浮动工具栏

在现有 Tiptap `BubbleMenu` 基础上扩展 AI 操作按钮，当用户选中文本时浮现：

**工具栏布局：**

```
┌─────────────────────────────────────────────────────────┐
│ B  I  U  S  │  润色  扩写  缩写  改写  翻译  解释  │
│ (格式按钮)   │  (AI 操作按钮，以分隔线区分)           │
└─────────────────────────────────────────────────────────┘
```

**AI 操作定义：**

| 操作 | 图标 | 说明 | 预期输出 |
|------|------|------|----------|
| 润色 | Sparkles | 优化文字表达，保持原意 | 修改后的文字 |
| 扩写 | Expand | 扩展选中内容，增加细节描写 | 扩展后的文字 |
| 缩写 | Shrink | 精简选中内容，去除冗余 | 精简后的文字 |
| 改写 | RefreshCw | 用不同方式重新表达 | 改写后的文字 |
| 翻译 | Languages | 翻译为指定语言 | 翻译后的文字 |
| 解释 | HelpCircle | 解释选中内容的含义/背景 | 解释文字（不替换原文） |

**内联 Diff 预览：**

点击 AI 操作后，不直接替换文本，而是显示内联 diff 预览：

```css
.inline-diff {
  position: relative;
  display: inline;
}

.inline-diff--deleted {
  background: hsl(var(--destructive) / 0.15);
  color: hsl(var(--destructive));
  text-decoration: line-through;
}

.inline-diff--added {
  background: hsl(var(--primary) / 0.15);
  color: hsl(var(--primary));
}

.inline-diff-actions {
  display: inline-flex;
  gap: 4px;
  margin-left: 8px;
  vertical-align: middle;
}
```

预览下方显示"接受"和"拒绝"按钮：

- 接受（`Ctrl+Enter`）：应用修改，替换原文
- 拒绝（`Esc`）：取消修改，恢复原文

→ 见 06-多模型协作.md § 3 了解 AI 操作的模型路由策略

### 7.3 AI 侧栏 (CopilotSidebar)

右面板的 Copilot 标签页从 v1 的单一对话模式升级为多标签页结构：

**标签页结构：**

```
┌──────────────────────────────────┐
│ [对话] [建议] [分析报告]          │  ← 下划线风格标签页
├──────────────────────────────────┤
│ 模型: [Claude 3.5 Sonnet ▾]     │  ← 模型选择器
├──────────────────────────────────┤
│                                  │
│  对话内容区域                     │
│                                  │
│  用户: 帮我为这个角色设计一段     │
│        内心独白                   │
│                                  │
│  AI: 好的，基于角色画像...        │
│      "月光透过窗帘的缝隙..."      │
│                                  │
│                                  │
├──────────────────────────────────┤
│ 本次消耗: ¥0.03 | 累计: ¥1.24   │  ← 费用显示
├──────────────────────────────────┤
│ [输入框...                    📎] │  ← 输入区域
│ [发送]                           │
└──────────────────────────────────┘
```

**三个标签页的职责：**

| 标签页 | 功能 | 数据来源 |
|--------|------|----------|
| 对话 | 与 AI 自由对话，讨论情节、角色、写作技巧 | 实时 AI 对话 API |
| 建议 | 展示 Beta Reader 的主动建议列表 | `beta_reader_issues` 表中 status=open 的条目 |
| 分析报告 | 快速查看最近一次 Beta Reader 分析结果摘要 | `beta_reader_reports` 表最新记录 |

**模型选择器：**

```typescript
interface ModelSelectorProps {
  models: Array<{
    id: string;
    name: string;
    provider: string;
    costPer1kTokens: number;
    capabilities: string[];
  }>;
  selectedModel: string;
  onSelect: (modelId: string) => void;
}
```

**费用显示组件：**

- 每条消息旁显示该消息的 token 消耗和费用
- 底部汇总栏显示本次会话累计费用
- 费用使用 `font-variant-numeric: tabular-nums` 确保数字对齐

→ 见 06-多模型协作.md § 2 了解模型选择和费用计算的详细设计

### 7.4 命令面板 AI 集成

全局命令面板（`Ctrl+K`）集成 AI 命令，使用 `AI:` 前缀区分：

**命令面板结构：**

```
┌──────────────────────────────────────────┐
│ 🔍 输入命令或搜索...                      │
├──────────────────────────────────────────┤
│ 最近使用                                  │
│   跳转到 第3章 > 场景2                    │
│   AI: 润色选中文本                        │
├──────────────────────────────────────────┤
│ AI 命令                                   │
│   AI: 为这个角色生成对话                   │
│   AI: 检查本章连续性                       │
│   AI: 生成场景描写                        │
│   AI: 分析当前章节节奏                    │
│   AI: 总结前文要点                        │
├──────────────────────────────────────────┤
│ 导航                                      │
│   跳转到章节...                           │
│   跳转到角色...                           │
│   跳转到 Lorebook 条目...                 │
├──────────────────────────────────────────┤
│ 操作                                      │
│   保存当前文档          Ctrl+S            │
│   导出...               Ctrl+Shift+E      │
│   切换专注模式          F11               │
│   切换主题                                │
└──────────────────────────────────────────┘
```

**AI 命令执行流程：**

1. 用户在命令面板输入自然语言指令（如"为李明写一段愤怒的独白"）
2. 系统识别为 AI 命令，显示 AI 图标标识
3. 按 `Enter` 执行，命令面板关闭
4. 结果以内联 diff 或侧栏对话形式展示（取决于命令类型）

```typescript
interface CommandPaletteItem {
  id: string;
  label: string;
  category: 'ai' | 'navigation' | 'action' | 'recent';
  icon: LucideIcon;
  shortcut?: string;
  execute: () => void | Promise<void>;
}
```

→ 见 07-工作台与体验优化.md § 3.4 了解命令面板的完整实现

---

## 8. 项目中心页 (Dashboard)

### 8.1 布局设计

v2 将 Dashboard 从简单的故事列表重新设计为以项目为中心的工作台首页：

```
┌─────────────────────────────────────────────────────────────┐
│  Sidebar │                                                  │
│          │  欢迎回来，{username}                             │
│  (同工   │  今日写作: {todayWords}字 / 目标 {dailyGoal}字   │
│   作台   │  [━━━━━━━━━━░░░░] 67%                           │
│   侧边   │                                                  │
│   栏)    ├──────────────────────────┬──────────────────────┤
│          │                          │                      │
│          │  最近项目                 │  写作统计             │
│          │                          │                      │
│          │  ┌─────────┐ ┌─────────┐ │  本周字数             │
│          │  │ 封面图   │ │ 封面图   │ │  ┌──────────────┐   │
│          │  │ 《星际》 │ │ 《古镇》 │ │  │ 折线图        │   │
│          │  │ 科幻     │ │ 悬疑     │ │  │ Mon-Sun      │   │
│          │  │ 45,230字 │ │ 12,800字 │ │  └──────────────┘   │
│          │  │ [继续写] │ │ [继续写] │ │                      │
│          │  └─────────┘ └─────────┘ │  连续写作: 12天       │
│          │                          │                      │
│          │  ┌─────────┐ ┌─────────┐ │  写作热力图           │
│          │  │ 封面图   │ │  + 新建  │ │  ┌──────────────┐   │
│          │  │ 《都市》 │ │  项目    │ │  │ ░▒▓█ 热力图   │   │
│          │  │ 都市     │ │         │ │  │ (30天)        │   │
│          │  │ 8,500字  │ │         │ │  └──────────────┘   │
│          │  │ [继续写] │ │         │ │                      │
│          │  └─────────┘ └─────────┘ │  平均每次: 1,234字   │
│          │                          │                      │
│          ├──────────────────────────┴──────────────────────┤
│          │                                                  │
│          │  最近活动                                         │
│          │  ● 2小时前  编辑了《星际迷途》第3章               │
│          │  ● 5小时前  Beta Reader 分析完成                  │
│          │  ● 昨天     导出了《古镇迷踪》EPUB               │
│          │  ● 2天前    创建了新角色「李明」                   │
│          │                                                  │
└──────────┴──────────────────────────────────────────────────┘
```

### 8.2 项目卡片设计

项目卡片是 Dashboard 的核心视觉元素，需要在有限空间内传达项目的关键信息：

**卡片结构：**

```typescript
interface ProjectCardProps {
  story: {
    id: string;
    title: string;
    genre: string;
    coverImage?: string;          // 封面图 URL
    totalWords: number;
    chaptersCompleted: number;
    chaptersTotal: number;
    lastEditedAt: Date;
  };
  onContinueWriting: () => void;
  onExport: () => void;
  onAnalyze: () => void;
}
```

**视觉规格：**

| 元素 | 规格 | 说明 |
|------|------|------|
| 卡片尺寸 | 280px × 320px | 固定宽度，自适应网格 |
| 封面区域 | 280px × 160px | 顶部半区，显示封面图或渐变占位 |
| 封面占位 | 基于类型的渐变色 | 科幻=蓝紫渐变，悬疑=深灰渐变，言情=粉红渐变，奇幻=绿金渐变 |
| 类型徽章 | 右上角，半透明背景 | 覆盖在封面图上 |
| 标题 | `text-lg`, `font-semibold` | 单行，超长截断 |
| 进度条 | 高度 4px，圆角 | `var(--primary)` 填充色 |
| 字数 | `text-sm`, `text-muted-foreground` | 格式化显示（如 45,230字） |
| 最后编辑 | `text-xs`, `text-muted-foreground` | 相对时间（如"2小时前"） |
| 快捷操作 | 底部按钮组 | 继续写作（primary）/ 更多（dropdown） |

**封面渐变占位色方案：**

```css
.cover-placeholder--scifi    { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.cover-placeholder--mystery  { background: linear-gradient(135deg, #434343 0%, #000000 100%); }
.cover-placeholder--romance  { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
.cover-placeholder--fantasy  { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
.cover-placeholder--history  { background: linear-gradient(135deg, #C9A96E 0%, #8B6F4E 100%); }
.cover-placeholder--urban    { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
.cover-placeholder--default  { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
```

### 8.3 写作统计面板

统计面板位于 Dashboard 右侧，使用 `recharts` 库渲染图表：

**本周字数折线图：**

```typescript
interface WeeklyChartData {
  day: string;          // "Mon" | "Tue" | ...
  words: number;        // 当日字数
  goal: number;         // 当日目标（水平虚线）
}

// 图表配置
const chartConfig = {
  width: '100%',
  height: 200,
  lineColor: 'hsl(var(--primary))',       // 鼠尾草绿
  goalLineColor: 'hsl(var(--border))',    // 虚线
  areaFill: 'hsl(var(--primary) / 0.1)',  // 半透明填充
  dotRadius: 4,
  activeDotRadius: 6,
};
```

**连续写作天数（Streak）：**

- 大号数字显示（`text-4xl`, `font-bold`）
- 下方小字"连续写作天数"
- 数字使用 `var(--primary)` 色
- 达到里程碑（7天、30天、100天）时显示特殊图标

**写作热力图（Calendar Heatmap）：**

- 类似 GitHub 贡献图，显示最近 30 天
- 每天一个小方块，颜色深浅表示字数多少
- 色阶：`var(--muted)` → `var(--primary)` 的 5 级渐变
- hover 显示具体日期和字数

```typescript
interface HeatmapCell {
  date: string;         // "2026-02-17"
  words: number;
  level: 0 | 1 | 2 | 3 | 4;  // 0=无写作, 4=超额完成
}
```

---

## 9. 知识图谱交互设计

### 9.1 交互式探索

知识图谱基于 `react-force-graph-2d` 实现，展示 Lorebook 中角色、地点、事件、物品、概念之间的关系网络。

**基础交互：**

| 操作 | 触发方式 | 效果 |
|------|----------|------|
| 缩放 | 鼠标滚轮 / 触控板捏合 | 图谱整体缩放，范围 0.1x - 5x |
| 平移 | 拖拽空白区域 | 图谱整体平移 |
| 选中节点 | 单击节点 | 显示节点详情弹出框 |
| 编辑节点 | 双击节点 | 跳转到对应 Lorebook 条目编辑页 |
| 移动节点 | 拖拽节点 | 重新定位节点（释放后物理引擎接管） |
| 查看关系 | hover 边 | 显示关系类型标签 |
| 搜索 | 顶部搜索框 | 匹配节点高亮，其余节点变暗（`opacity: 0.2`） |
| 筛选 | 类型筛选按钮组 | 切换显示/隐藏特定类型的节点 |
| 深度控制 | 底部滑块 | 限制从选中节点出发的关系深度（1-5 层） |

### 9.2 节点视觉设计

不同类型的 Lorebook 条目使用不同的形状和颜色，确保在图谱中一眼可辨：

| 类型 | 形状 | 填充色 | 大小规则 | 图标 |
|------|------|--------|----------|------|
| Character（角色） | 圆形 | `#5B7F67` 鼠尾草绿 | 基础 12px + 连接数 × 2px | 有头像则显示头像 |
| Location（地点） | 六边形 | `#6B8FA3` 雾蓝 | 基础 10px + 连接数 × 2px | MapPin 图标 |
| Event（事件） | 菱形 | `#D4A574` 琥珀 | 基础 10px + 连接数 × 2px | Calendar 图标 |
| Item（物品） | 方形 | `#5BA37F` 翡翠 | 基础 8px + 连接数 × 2px | Package 图标 |
| Concept（概念） | 三角形 | `#8B6FA3` 紫藤 | 基础 8px + 连接数 × 2px | Lightbulb 图标 |

**节点状态：**

```css
/* 默认状态 */
.graph-node {
  stroke: transparent;
  stroke-width: 2px;
  transition: all 150ms ease;
}

/* 选中状态 - 发光环 */
.graph-node--selected {
  stroke: hsl(var(--primary));
  stroke-width: 3px;
  filter: drop-shadow(0 0 8px hsl(var(--primary) / 0.5));
}

/* 搜索匹配 - 脉冲动画 */
.graph-node--searched {
  animation: node-pulse 1.5s ease-in-out infinite;
}

@keyframes node-pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.15); }
}

/* 非匹配节点 - 变暗 */
.graph-node--dimmed {
  opacity: 0.15;
}
```

**边（关系线）样式：**

| 关系类型 | 线型 | 颜色 | 说明 |
|----------|------|------|------|
| 亲属关系 | 实线 | `#5B7F67` | 家庭、血缘 |
| 社交关系 | 实线 | `#6B8FA3` | 朋友、同事、敌人 |
| 空间关系 | 虚线 | `#D4A574` | 位于、前往 |
| 因果关系 | 箭头线 | `#C0392B` | 导致、引发 |
| 拥有关系 | 点线 | `#8B6FA3` | 持有、属于 |

### 9.3 编辑能力

图谱不仅是只读的可视化工具，还支持直接编辑：

**节点编辑弹出框：**

```
┌──────────────────────────┐
│ 角色: 李明               │
│ ┌──────────────────────┐ │
│ │ 名称: [李明        ] │ │
│ │ 类型: [角色 ▾      ] │ │
│ │ 描述: [年轻的侦探...] │ │
│ └──────────────────────┘ │
│ 关系 (3)                 │
│  → 王芳 (恋人)           │
│  → 张警官 (搭档)         │
│  → 古镇 (居住地)         │
│                          │
│ [编辑详情] [删除]        │
└──────────────────────────┘
```

**右键上下文菜单：**

| 菜单项 | 说明 |
|--------|------|
| 编辑节点 | 打开节点编辑弹出框 |
| 删除节点 | 确认后删除节点及其所有关系 |
| 添加关系 | 进入"连线模式"，点击目标节点创建关系 |
| 以此为中心 | 将图谱视图居中到该节点 |
| 在 Lorebook 中查看 | 跳转到 Lorebook 编辑页面 |

**拖拽创建关系：**

1. 从源节点开始拖拽（按住 `Shift` + 拖拽）
2. 拖拽过程中显示虚线连接线
3. 释放到目标节点上
4. 弹出关系类型选择器（下拉菜单）
5. 选择关系类型后创建关系
6. 变更通过 API 同步到 Lorebook + Neo4j

→ 见 01-上下文记忆系统.md § 3 了解知识图谱的数据模型和 Neo4j 集成

---

## 10. Beta Reader 报告交互设计

### 10.1 卡片式报告展示

Beta Reader 分析报告以卡片形式展示，提供从概览到细节的渐进式信息架构：

**报告概览卡片：**

```
┌──────────────────────────────────────────────┐
│  Beta Reader 分析报告                         │
│  2026-02-17 14:30  |  第3章 - 古镇迷踪        │
├──────────────────────────────────────────────┤
│                                              │
│  ┌────────────────┐   综合评分: 78/100       │
│  │   雷达图        │                          │
│  │  (5维度)        │   连续性: 85  ████████░  │
│  │                │   角色一致: 72  ███████░░  │
│  └────────────────┘   叙事节奏: 80  ████████░  │
│                       对话质量: 75  ███████░░  │
│                       文风一致: 78  ████████░  │
│                                              │
│  发现 12 个问题: 2 严重 / 5 警告 / 5 建议    │
│                                              │
│  [查看完整报告]                               │
└──────────────────────────────────────────────┘
```

**雷达图配置：**

```typescript
interface RadarChartConfig {
  dimensions: Array<{
    key: string;
    label: string;
    score: number;        // 0-100
    maxScore: 100;
  }>;
  fillColor: 'hsl(var(--primary) / 0.2)';
  strokeColor: 'hsl(var(--primary))';
  size: 200;              // px
}
```

**展开后的完整报告：**

每个维度展开为独立的可折叠卡片，内含该维度下的所有问题：

```
┌──────────────────────────────────────────────┐
│ ▼ 连续性检查  85/100  [2个问题]              │
├──────────────────────────────────────────────┤
│  ┌────────────────────────────────────────┐  │
│  │ ⚠ 警告: 角色眼睛颜色不一致             │  │
│  │ 第3章第2段: "她的蓝色眼睛..."           │  │
│  │ 与第1章第5段: "棕色的眼眸..." 矛盾      │  │
│  │ 建议: 统一为棕色                        │  │
│  │ [定位到文本] [标记已解决] [忽略]        │  │
│  └────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────┐  │
│  │ ℹ 建议: 时间线可能存在冲突              │  │
│  │ ...                                    │  │
│  └────────────────────────────────────────┘  │
└──────────────────────────────────────────────┘
```

### 10.2 编辑器联动

Beta Reader 报告与编辑器深度联动，实现"发现问题→定位问题→修复问题"的闭环：

**问题定位：**

- 点击报告中的"定位到文本"按钮，编辑器自动滚动到对应文本段落
- 对应文本段落高亮显示（背景色 `hsl(var(--destructive) / 0.1)` 或 `hsl(var(--warning) / 0.1)`）
- 高亮持续 3 秒后渐隐

**编辑器边栏标记（Gutter Markers）：**

在编辑器左侧边栏（gutter）显示问题标记点：

```css
.gutter-marker {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  cursor: pointer;
  transition: transform 100ms ease;
}

.gutter-marker:hover {
  transform: scale(1.5);
}

.gutter-marker--critical {
  background: hsl(var(--destructive));        /* 红色 - 严重问题 */
}

.gutter-marker--warning {
  background: #D4A574;                        /* 琥珀 - 警告 */
}

.gutter-marker--info {
  background: #6B8FA3;                        /* 雾蓝 - 建议 */
}
```

**Gutter 标记交互：**

| 操作 | 效果 |
|------|------|
| hover | 显示工具提示，包含问题摘要 |
| 单击 | 展开内联问题详情卡片（在编辑器内，问题行下方） |
| 右键 | 上下文菜单：查看详情 / 标记已解决 / 忽略 |

### 10.3 问题管理面板

在右面板的 Analysis 标签页中，提供问题的集中管理视图：

**筛选与排序：**

```typescript
interface IssueFilterState {
  types: Array<'continuity' | 'character' | 'pacing' | 'dialogue' | 'style'>;
  severities: Array<'critical' | 'warning' | 'info'>;
  statuses: Array<'open' | 'acknowledged' | 'resolved' | 'ignored'>;
  sortBy: 'severity' | 'type' | 'position' | 'created_at';
  sortOrder: 'asc' | 'desc';
}
```

**问题卡片样式：**

```css
.issue-card {
  border-left: 3px solid;
  padding: 12px;
  margin-bottom: 8px;
  border-radius: 0 6px 6px 0;
  background: hsl(var(--card));
}

.issue-card--critical { border-left-color: hsl(var(--destructive)); }
.issue-card--warning  { border-left-color: #D4A574; }
.issue-card--info     { border-left-color: #6B8FA3; }
```

**批量操作：**

- 全选 / 取消全选
- 批量标记已确认
- 批量标记已解决
- 批量忽略

→ 见 03-AI-Beta-Reader与连续性检查.md § 3 了解 Beta Reader 的分析维度和问题数据模型

---

## 11. 版本对比交互设计

### 11.1 并排 Diff 视图

版本对比采用并排（side-by-side）布局，左侧显示旧版本，右侧显示新版本：

```
┌──────────────────────────────────────────────────────┐
│  版本对比                                             │
│  场景: [第3章 > 场景2 ▾]  变更: 15处                 │
├─────────────────────────┬────────────────────────────┤
│  v3 (2月15日 14:30)     │  v5 (2月17日 09:15)        │
│  自动快照               │  手动检查点: "修改结局"     │
├─────────────────────────┬────────────────────────────┤
│  1  她走进了房间，       │  1  她走进了房间，          │
│  2  环顾四周。           │  2  环顾四周。              │
│  3  ░░░ 3行未变更 ░░░   │  3  ░░░ 3行未变更 ░░░      │
│  6  "你来了。"他说。     │  6  "你终于来了。"他说，    │
│     ─────────────        │     ──────────────          │
│     (红色背景: 删除)     │     (绿色背景: 新增)        │
│                          │  7  声音里带着一丝疲惫。     │
│                          │     (绿色背景: 新增行)       │
│  7  她没有回答。         │  8  她没有回答。             │
├─────────────────────────┴────────────────────────────┤
│  [◀ 上一处变更]  3/15  [下一处变更 ▶]               │
└──────────────────────────────────────────────────────┘
```

**Diff 高亮样式：**

```css
/* 删除的内容 - 左侧 */
.diff-deleted {
  background: hsl(var(--destructive) / 0.12);
}

.diff-deleted-text {
  background: hsl(var(--destructive) / 0.25);
  text-decoration: line-through;
  color: hsl(var(--destructive));
}

/* 新增的内容 - 右侧 */
.diff-added {
  background: hsl(var(--primary) / 0.12);
}

.diff-added-text {
  background: hsl(var(--primary) / 0.25);
  color: hsl(var(--primary));
}

/* 折叠的未变更区域 */
.diff-fold {
  background: hsl(var(--muted));
  color: hsl(var(--muted-foreground));
  text-align: center;
  padding: 4px;
  cursor: pointer;
  font-size: 12px;
}

.diff-fold:hover {
  background: hsl(var(--accent));
}
```

**变更导航：**

- 上/下箭头按钮跳转到上一处/下一处变更
- 快捷键：`Alt+↑` / `Alt+↓`
- 当前变更位置指示器：`3/15`
- 滚动同步：左右面板同步滚动

### 11.2 场景选择器

Diff 视图顶部的场景选择器，用于在不同场景间切换对比：

```typescript
interface SceneSelectorProps {
  scenes: Array<{
    id: string;
    chapterTitle: string;
    sceneTitle: string;
    changeCount: number;       // 该场景的变更数量
    hasChanges: boolean;
  }>;
  selectedSceneId: string | 'all';
  onSelect: (sceneId: string | 'all') => void;
}
```

- 下拉菜单形式
- 有变更的场景右侧显示变更数量徽章
- "全部场景"选项用于查看完整稿件的 diff
- 无变更的场景以灰色显示

### 11.3 版本时间线

在右面板的 Version 标签页中，以垂直时间线形式展示版本历史：

```
┌──────────────────────────────────┐
│  版本历史                         │
│  ┌─ ● 手动检查点 "修改结局"      │
│  │    2月17日 09:15               │
│  │    净增 +234字                 │
│  │    [对比] [恢复]               │
│  │                                │
│  ├─ ○ 自动快照                    │
│  │    2月16日 22:00               │
│  │    净增 +1,205字               │
│  │                                │
│  ├─ ◆ 分支点 "尝试悲剧结局"      │
│  │    2月16日 15:30               │
│  │    [查看分支]                  │
│  │                                │
│  ├─ ○ 自动快照                    │
│  │    2月15日 14:30               │
│  │                                │
│  ├─ ◇ 合并点                     │
│  │    2月14日 20:00               │
│  │    合并自 "尝试悲剧结局"       │
│  │                                │
│  └─ ● 手动检查点 "初稿完成"      │
│       2月14日 10:00               │
└──────────────────────────────────┘
```

**时间线节点样式：**

| 节点类型 | 形状 | 颜色 | 大小 |
|----------|------|------|------|
| 自动快照 | 空心圆 `○` | `var(--muted-foreground)` | 8px |
| 手动检查点 | 实心圆 `●` | `var(--primary)` | 12px |
| 分支点 | 实心菱形 `◆` | `#D4A574` 琥珀 | 12px |
| 合并点 | 空心菱形 `◇` | `#5B7F67` 鼠尾草绿 | 12px |

**版本选择对比：**

- 点击第一个版本节点，节点高亮为蓝色边框
- 点击第二个版本节点，自动打开 Diff 视图对比两个版本
- 也可通过每个节点的"对比"按钮，与当前版本对比

→ 见 04-版本控制系统.md § 3 了解版本存储和分支管理的详细设计

---

## 12. 导出预览交互设计

### 12.1 实时预览面板

导出对话框采用左右分栏布局，左侧为配置区域，右侧为实时预览：

```
┌──────────────────────────────────────────────────────────┐
│  导出稿件                                          [×]   │
├────────────────────────┬─────────────────────────────────┤
│  导出配置               │  预览                           │
│                        │                                 │
│  格式: [EPUB ▾]        │  ┌─────────────────────────┐   │
│                        │  │                         │   │
│  范围:                  │  │   《星际迷途》           │   │
│  ○ 全书                │  │                         │   │
│  ● 选定章节             │  │   第一章 启程            │   │
│    ☑ 第1章             │  │                         │   │
│    ☑ 第2章             │  │   夜空中最亮的那颗星     │   │
│    ☐ 第3章             │  │   正在缓缓移动...        │   │
│                        │  │                         │   │
│  样式:                  │  │                         │   │
│  字体: [思源宋体 ▾]    │  └─────────────────────────┘   │
│  字号: [14px ▾]        │                                 │
│  行距: [1.8 ▾]         │  [◀ 第1页] 1/3 [第3页 ▶]      │
│  页边距: [标准 ▾]      │  缩放: [━━━━●━━] 100%          │
│                        │                                 │
│  元数据:                │  [在新窗口中打开完整预览]       │
│  作者: [________]      │                                 │
│  简介: [________]      │                                 │
│                        │                                 │
│  [取消]    [导出]      │                                 │
└────────────────────────┴─────────────────────────────────┘
```

**预览渲染策略：**

| 格式 | 预览方式 | 说明 |
|------|----------|------|
| EPUB | 样式化 HTML | 使用 EPUB CSS 样式渲染为 HTML，最接近最终效果 |
| PDF | 图片 | 后端生成 PDF 后转为图片返回前端，精确预览 |
| DOCX | 样式化 HTML | 使用 DOCX 样式近似渲染为 HTML |
| TXT | 纯文本 | 等宽字体显示，应用格式化规则（缩进、空行等） |

**预览更新机制：**

- 配置变更后 500ms 防抖触发预览更新
- 更新期间显示加载骨架屏
- 仅预览前 3 页，减少渲染开销
- 预览区域支持滚轮缩放（50% - 200%）

### 12.2 预览控件

```typescript
interface PreviewControlsProps {
  currentPage: number;
  totalPages: number;
  zoom: number;                // 50-200
  onPageChange: (page: number) => void;
  onZoomChange: (zoom: number) => void;
  onOpenFullPreview: () => void;
}
```

- 页面导航：上一页/下一页按钮 + 页码显示
- 缩放滑块：50% - 200%，步进 10%
- 全屏预览按钮：在新浏览器标签页中打开完整预览

→ 见 05-稿件导出系统.md § 3 了解导出格式和样式配置的详细设计

---

## 13. 响应式策略

### 13.1 桌面优先

AINovel 是专业写作工具，桌面端是主要使用场景。响应式策略以桌面为基准，向下降级：

**断点定义：**

| 断点 | 宽度范围 | 设备类型 | 布局策略 |
|------|----------|----------|----------|
| `xl` | ≥ 1440px | 大屏桌面 | 完整三面板布局，最佳体验 |
| `lg` | 1280px - 1439px | 标准桌面 | 完整三面板布局，面板比例微调 |
| `md` | 768px - 1279px | 平板/小屏 | 单面板 + 标签导航，折叠侧边栏 |
| `sm` | < 768px | 手机 | 简化视图，基础编辑功能 |

**超宽屏适配（> 2560px）：**

```css
@media (min-width: 2560px) {
  .app-container {
    max-width: 2560px;
    margin: 0 auto;
    /* 居中内容，两侧留白 */
  }
}
```

### 13.2 移动端降级

移动端（< 1280px）采用渐进降级策略，保留核心编辑能力，隐藏复杂功能：

**保留的功能：**

- 简化编辑器（基础文本编辑，无多面板）
- 章节导航（底部标签栏切换）
- 基础 AI 对话（全屏对话界面）
- 只读报告查看
- 基础设置

**隐藏的功能：**

- 知识图谱可视化（需要大屏交互）
- 版本 Diff 对比（并排布局不适合小屏）
- 多面板布局（空间不足）
- 导出预览（预览面板需要足够宽度）
- 拖拽排序（触控拖拽体验差）

**移动端布局：**

```
┌──────────────────────┐
│  ≡  AINovel  ⚙️      │  ← 顶部导航栏
├──────────────────────┤
│                      │
│  编辑器              │
│  (全屏宽度)          │
│                      │
│                      │
│                      │
│                      │
├──────────────────────┤
│ [章节] [AI] [设置]   │  ← 底部标签栏
└──────────────────────┘
```

---

## 14. 无障碍 (Accessibility)

### 14.1 目标标准

AINovel v2 以 WCAG 2.1 AA 级别为目标，确保所有核心功能对残障用户可用。

### 14.2 键盘导航

所有交互元素必须支持键盘操作：

| 元素 | Tab 可聚焦 | Enter/Space 激活 | Esc 关闭 | 方向键导航 |
|------|-----------|-----------------|---------|-----------|
| 按钮 | 是 | 是 | — | — |
| 输入框 | 是 | — | — | — |
| 下拉菜单 | 是 | 是（展开） | 是（收起） | 是（选项间） |
| 对话框 | 焦点陷阱 | — | 是（关闭） | — |
| 标签页 | 是 | 是（切换） | — | 是（标签间） |
| 树形控件 | 是 | 是（展开/折叠） | — | 是（节点间） |
| 面板拖拽手柄 | 是 | — | — | 是（调整大小） |

**焦点可见指示器：**

```css
*:focus-visible {
  outline: 2px solid hsl(var(--ring));
  outline-offset: 2px;
}

/* 编辑器内部不显示外部焦点环 */
.tiptap-editor:focus-visible {
  outline: none;
  box-shadow: inset 0 0 0 2px hsl(var(--ring) / 0.3);
}
```

### 14.3 ARIA 标注

所有图标按钮必须提供 `aria-label`：

```typescript
// 正确示例
<Button variant="ghost" size="icon" aria-label="折叠侧边栏">
  <PanelLeftClose className="h-4 w-4" />
</Button>

// 错误示例 - 缺少 aria-label
<Button variant="ghost" size="icon">
  <PanelLeftClose className="h-4 w-4" />
</Button>
```

**关键 ARIA 属性清单：**

| 组件 | 必需 ARIA 属性 | 说明 |
|------|---------------|------|
| 图标按钮 | `aria-label` | 描述按钮功能 |
| 侧边栏 | `role="navigation"`, `aria-label="主导航"` | 标识导航区域 |
| 编辑器 | `role="textbox"`, `aria-multiline="true"` | 标识编辑区域 |
| 状态栏 | `role="status"`, `aria-live="polite"` | 状态变更自动播报 |
| 进度条 | `role="progressbar"`, `aria-valuenow`, `aria-valuemin`, `aria-valuemax` | 进度信息 |
| 对话框 | `role="dialog"`, `aria-modal="true"`, `aria-labelledby` | 模态对话框 |
| 标签页 | `role="tablist"`, `role="tab"`, `role="tabpanel"` | 标签页结构 |
| 树形控件 | `role="tree"`, `role="treeitem"`, `aria-expanded` | 大纲树 |
| Toast 通知 | `role="alert"`, `aria-live="assertive"` | 即时通知 |

### 14.4 色彩对比度

所有文字与背景的对比度必须满足 WCAG 2.1 AA 标准：

- 正常文字（< 18px）：对比度 ≥ 4.5:1
- 大号文字（≥ 18px 或 ≥ 14px bold）：对比度 ≥ 3:1
- 非文字元素（图标、边框）：对比度 ≥ 3:1

不依赖颜色作为唯一的信息传达方式：

- 错误状态：红色 + 错误图标 + 错误文字
- 成功状态：绿色 + 勾选图标 + 成功文字
- Diff 视图：颜色 + 删除线/下划线 + 行号标记

### 14.5 屏幕阅读器支持

- 状态栏更新使用 `aria-live="polite"` 自动播报
- 保存状态变更使用 `aria-live="polite"` 播报
- 错误提示使用 `aria-live="assertive"` 立即播报
- AI 生成内容完成后播报"AI 建议已生成"
- 图表提供文字替代描述（`aria-label` 包含关键数据点）

### 14.6 动效无障碍

```css
@media (prefers-reduced-motion: reduce) {
  /* 禁用所有非必要动画 */
  .skeleton { animation: none; background: hsl(var(--muted)); }
  .graph-node--searched { animation: none; }
  .dialog-content { animation: none; }
  .toast { animation: none; }

  /* 保留必要的状态指示（使用即时切换代替动画） */
  * { transition-duration: 0.01ms !important; }
}
```

---

## 15. 与现有代码的集成点

### 15.1 需修改的现有文件

以下表格列出设计系统落地时需要修改的现有前端文件及其改动范围：

| 文件路径 | 改动类型 | 改动说明 |
|----------|----------|----------|
| `frontend/src/layouts/AppLayout.tsx` | 重构 | 侧边栏折叠行为集成、主题 class 切换逻辑、面板布局容器 |
| `frontend/src/pages/Workbench/Workbench.tsx` | 重构 | 从 Tab 布局替换为 `ResizablePanelGroup` 三面板布局，集成预设布局切换 |
| `frontend/src/pages/Workbench/ManuscriptWriter.tsx` | 增强 | 集成内联 AI 建议（Ghost Text）、Gutter 问题标记、状态栏数据源 |
| `frontend/src/components/editor/TiptapEditor.tsx` | 增强 | 添加 GhostText 扩展、增强 BubbleMenu AI 操作、打字机滚动支持 |
| `frontend/src/components/ai/CopilotSidebar.tsx` | 增强 | 从单一对话升级为多标签页（对话/建议/分析报告），添加模型选择器和费用显示 |
| `frontend/src/pages/Settings/AppearanceSettings.tsx` | 增强 | 集成新的四主题色板切换、CSS 变量动态注入、字体选择 |
| `frontend/src/pages/Dashboard/Dashboard.tsx` | 重设计 | 完全重新设计为项目中心页，包含项目卡片网格、写作统计面板、活动时间线 |
| `frontend/src/styles/globals.css` | 重构 | 添加完整的 CSS 变量定义（四套主题）、动效变量、字体导入 |
| `frontend/tailwind.config.ts` | 增强 | 映射 CSS 变量到 Tailwind 工具类、添加自定义动画配置 |

### 15.2 需新增的组件

| 组件路径 | 说明 |
|----------|------|
| `frontend/src/components/ui/status-bar.tsx` | 底部状态栏组件 |
| `frontend/src/components/ui/command-palette.tsx` | 全局命令面板组件 |
| `frontend/src/components/editor/ghost-text.ts` | Tiptap GhostText 扩展 |
| `frontend/src/components/editor/inline-diff.tsx` | 内联 Diff 预览组件 |
| `frontend/src/components/editor/gutter-markers.tsx` | 编辑器边栏问题标记组件 |
| `frontend/src/components/graph/knowledge-graph.tsx` | 知识图谱可视化组件 |
| `frontend/src/components/graph/node-popover.tsx` | 图谱节点详情弹出框 |
| `frontend/src/components/report/radar-chart.tsx` | Beta Reader 雷达图组件 |
| `frontend/src/components/report/issue-card.tsx` | 问题卡片组件 |
| `frontend/src/components/version/diff-viewer.tsx` | 版本 Diff 对比组件 |
| `frontend/src/components/version/timeline.tsx` | 版本时间线组件 |
| `frontend/src/components/export/preview-panel.tsx` | 导出预览面板组件 |
| `frontend/src/components/dashboard/project-card.tsx` | 项目卡片组件 |
| `frontend/src/components/dashboard/writing-stats.tsx` | 写作统计面板组件 |
| `frontend/src/components/dashboard/activity-feed.tsx` | 活动时间线组件 |
| `frontend/src/components/dashboard/heatmap.tsx` | 写作热力图组件 |
| `frontend/src/components/zen-mode/zen-mode.tsx` | 专注模式容器组件 |

### 15.3 第三方依赖

| 包名 | 版本 | 用途 | 是否已安装 |
|------|------|------|-----------|
| `react-resizable-panels` | ^2.x | 面板拖拽调整 | 是（v1 已有） |
| `@tiptap/react` | ^2.x | 富文本编辑器 | 是（v1 已有） |
| `recharts` | ^2.x | 图表（折线图、雷达图） | 需新增 |
| `react-force-graph-2d` | ^1.x | 知识图谱力导向图 | 需新增 |
| `canvas-confetti` | ^1.x | 目标达成彩纸动效 | 需新增 |
| `cmdk` | ^1.x | 命令面板 | 需新增 |
| `diff` | ^5.x | 文本 Diff 计算 | 需新增 |
| `date-fns` | ^3.x | 日期格式化（相对时间） | 是（v1 已有） |

### 15.4 设计 Token 导出

设计系统的所有 Token（颜色、字号、间距、动效参数）统一在 `globals.css` 中以 CSS 变量形式定义，确保设计与代码的单一数据源：

```
globals.css (CSS 变量定义)
    ↓
tailwind.config.ts (映射为 Tailwind 工具类)
    ↓
组件代码 (通过 Tailwind 类名或 CSS 变量引用)
```

任何设计 Token 的变更只需修改 `globals.css` 中的变量值，即可全局生效。

---

## 附录 A：图标规范

AINovel v2 统一使用 `lucide-react` 图标库，以下是各模块的核心图标映射：

| 功能 | 图标名称 | 用途 |
|------|----------|------|
| 保存 | `Save` | 手动保存按钮 |
| 导出 | `Download` | 导出操作 |
| AI 对话 | `MessageSquare` | Copilot 侧栏 |
| AI 建议 | `Sparkles` | AI 润色、内联建议 |
| 分析 | `BarChart3` | Beta Reader 报告 |
| 版本 | `GitBranch` | 版本控制 |
| 设置 | `Settings` | 设置页面 |
| 搜索 | `Search` | 搜索框、命令面板 |
| 折叠 | `PanelLeftClose` / `PanelRightClose` | 面板折叠 |
| 专注模式 | `Maximize2` | 进入专注模式 |
| 退出专注 | `Minimize2` | 退出专注模式 |
| 角色 | `User` | Lorebook 角色条目 |
| 地点 | `MapPin` | Lorebook 地点条目 |
| 事件 | `Calendar` | Lorebook 事件条目 |
| 物品 | `Package` | Lorebook 物品条目 |
| 概念 | `Lightbulb` | Lorebook 概念条目 |
| 警告 | `AlertTriangle` | 警告提示 |
| 错误 | `AlertCircle` | 错误提示 |
| 成功 | `CheckCircle` | 成功提示 |
| 信息 | `Info` | 信息提示 |

图标尺寸规范：

| 场景 | 尺寸 | Tailwind 类 |
|------|------|-------------|
| 按钮内图标 | 16px | `h-4 w-4` |
| 侧边栏图标 | 20px | `h-5 w-5` |
| 空状态图标 | 48px | `h-12 w-12` |
| 页面标题图标 | 24px | `h-6 w-6` |

---

## 附录 B：阴影层级

AINovel v2 使用克制的阴影系统，仅定义 3 个层级：

| 层级 | CSS 值 | 用途 |
|------|--------|------|
| `shadow-sm` | `0 1px 3px rgba(0, 0, 0, 0.04)` | 卡片默认状态、输入框 |
| `shadow-md` | `0 2px 8px rgba(0, 0, 0, 0.08)` | 卡片 hover、下拉菜单、弹出框 |
| `shadow-lg` | `0 25px 50px -12px rgba(0, 0, 0, 0.25)` | 模态对话框 |

暗色主题下阴影调整：

```css
.dark {
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.2);
  --shadow-md: 0 2px 8px rgba(0, 0, 0, 0.3);
  --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
}
```

---

## 附录 C：间距速查表

基于 4px 基准网格的间距系统：

| Token | 值 | 常见用途 |
|-------|-----|----------|
| `space-1` | 4px | 图标与文字间距、紧凑元素间距 |
| `space-2` | 8px | 按钮组间距、表单元素间距 |
| `space-3` | 12px | 卡片内元素间距 |
| `space-4` | 16px | 卡片内边距、面板内边距 |
| `space-6` | 24px | 区块间距、对话框内边距 |
| `space-8` | 32px | 大区块间距、页面区域间距 |
| `space-12` | 48px | 编辑器上下内边距 |
| `space-16` | 64px | 编辑器左右内边距 |
